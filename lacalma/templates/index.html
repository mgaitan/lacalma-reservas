{% load staticfiles %}
{% load crispy_forms_tags %}
<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Reservas La Calma</title>
		<link rel="stylesheet" href="{% static "daterangepicker.css"  %}"/>

		<link rel="stylesheet" href="{% static "css/bootstrap.min.css"  %}"/>
		<script src="{% static "jquery-1.5.1.min.js" %}"></script>
		<script src="{% static "moment.min.js" %}"></script>
		<script src="{% static "jquery.daterangepicker.js" %}"></script>
		<style>
		#wrapper
		{
			width:800px;
			margin:0 auto;
			color:#333;
			font-family:Tahoma;
			line-height:1.5;
			font-size:14px;
		}
		.date-picker-wrapper .month-wrapper table .day.pendiente { background-color:orange; }
		.date-picker-wrapper .month-wrapper table .day.confirmada { background-color:#99FF66; }
		.options { display:none; border-left:6px solid #8ae; padding:10px; font-size:12px; line-height:1.4; background-color:#eee; border-radius:4px;}
		</style>
	</head>
	<body>

		<div id="wrapper">
			<h1>Haga su reserva</h1>

		<form action="" method="post">
		{% csrf_token %}
    	{{ form|crispy }}
    	<input type="submit" value="Send message" />
		</form>


	<script type="text/javascript">

	var pendientes = {{ reservas_pendientes|safe }};
	var confirmadas = {{ reservas_confirmadas|safe }};


	function update_reservas(){
		$('#id_fechas').dateRangePicker({
				separator: ' al ',
				format: 'DD-MM-YYYY',
				//startDate: '{{ hoy }}',
				showShortcuts: false,
				startOfWeek: 'monday',
				beforeShowDay: function(t)
				{
					depto = $('#id_departamento').val();

					hoy = moment('{{ hoy }}', 'YYYY-MM-DD').toDate()
					if (parseInt(moment(t).format('YYYYMMDD')) < parseInt(moment(hoy).format('YYYYMMDD'))){
						return [false,'',''];
					}

					dia = moment(t).format('YYYY-MM-DD');

					if(pendientes[depto].indexOf(dia) > -1){
						return [false,'pendiente','Reserva pendiente'];
					}
					if(confirmadas[depto].indexOf(dia) > -1){
						return [false,'confirmada','Reserva confirmada'];
					}
					return [true,'',''];
				}

			});
	}


	$(function(){
		$('#id_departamento').change(update_reservas);
		update_reservas();

	});
	</script>



	</body>


</html>
