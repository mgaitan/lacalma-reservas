{% load staticfiles %}
{% load crispy_forms_tags %}
<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Reservas La Calma</title>
		<link rel="stylesheet" href="{% static "daterangepicker.css"  %}"/>

		<link rel="stylesheet" href="{% static "css/bootstrap.min.css"  %}"/>
		<script src="{% static "jquery-1.5.1.min.js" %}"></script>
		<script src="{% static "moment.min.js" %}"></script>
		<script src="{% static "jquery.daterangepicker.js" %}"></script>
		<style>
		#wrapper
		{
			width:800px;
			margin:0 auto;
			color:#333;
			font-family:"Droid Sans", sans-serif;
			line-height:1.5;
			font-size:14px;
		}
		.date-picker-wrapper .month-wrapper table .day.pendiente { background-color:orange; }
		.date-picker-wrapper .month-wrapper table .day.confirmada { background-color:#99FF66; }
		.options { display:none; border-left:6px solid #8ae; padding:10px; font-size:12px; line-height:1.4; background-color:#eee; border-radius:4px;}
		</style>
	</head>
	<body>

		<div id="wrapper">


		{% if gracias %}


		<div class="row"></div>

			    <div class="alert alert-success" >

    <strong>¡Felicitaciones!</strong> Hemos recibido su solicitud. En breve recibirá un correo electrónico con las instrucciones para realizar el depósito de seña y confirmar su reserva. ¡Gracias por visitar Las Grutas!
    </div>



		{% else %}


		{% if reserva %}

			<h3>Verifique su reserva</h3>


			{% include "detalles_reserva.html" %}


		<form action="" method="post">{% csrf_token %}
		{% for field in form %}{{ field.as_hidden }}
		{% endfor %}
		<input type="hidden" name="{{ stage_field }}" value="2" />
		<input type="hidden" name="{{ hash_field }}" value="{{ hash_value }}" />
		<p>
 		<a id="back" class="btn">Volver</a>
		<input type="submit"  class="btn" value="Confirmar reserva" /></p>
		</form>

		{% else %}
			<h1>Haga su reserva online</h1>


		<form action="" method="post">
		{% csrf_token %}
    	{{ form|crispy }}
    	<input type="submit" class="btn" value="Siguiente" />
		</form>


		{% endif %}



		{% endif %}
		</div>

	<script type="text/javascript">

	var pendientes = {{ reservas_pendientes|safe }};
	var confirmadas = {{ reservas_confirmadas|safe }};


	function update_reservas(){
		$('#formtools_fechas').dateRangePicker({
				separator: ' al ',
				format: 'DD-MM-YYYY',
				//startDate: '{{ hoy }}',
				showShortcuts: false,
				startOfWeek: 'monday',
				alwaysOpen:false,
				beforeShowDay: function(t)
				{
					depto = $('#formtools_departamento').val();

					hoy = moment('{{ hoy }}', 'YYYY-MM-DD').toDate();
					if (parseInt(moment(t).format('YYYYMMDD')) < parseInt(moment(hoy).format('YYYYMMDD'))){
						return [false,'',''];
					}

					dia = moment(t).format('YYYY-MM-DD');

					if(pendientes[depto].indexOf(dia) > -1){
						return [false,'pendiente','Reserva pendiente'];
					}
					if(confirmadas[depto].indexOf(dia) > -1){
						return [false,'confirmada','Reserva confirmada'];
					}
					return [true,'',''];
				}

			});
	}


	$(function(){
		$('#formtools_departamento').change( function(){
			update_reservas();
		});
		update_reservas();

		$('#back').click(function(e){
			e.preventDefault();
			window.history.back();
			return false;
		})

	});
	</script>



	</body>


</html>
